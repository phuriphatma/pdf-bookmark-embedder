(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();const g="modulepreload",y=function(u){return"/"+u},m={},v=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){let o=function(i){return Promise.all(i.map(c=>Promise.resolve(c).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),h=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));r=o(t.map(i=>{if(i=y(i),i in m)return;m[i]=!0;const c=i.endsWith(".css"),d=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${d}`))return;const a=document.createElement("link");if(a.rel=c?"stylesheet":g,c||(a.as="script"),a.crossOrigin="",a.href=i,h&&a.setAttribute("nonce",h),document.head.appendChild(a),c)return new Promise((p,f)=>{a.addEventListener("load",p),a.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})}))}function s(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return r.then(o=>{for(const l of o||[])l.status==="rejected"&&s(l.reason);return e().catch(s)})};class w{constructor(){this.serverUrl=this.getServerUrl(),this.currentFile=null,this.initializeElements(),this.bindEvents()}async embedBookmarks(e,t){try{console.log("📤 Sending PDF to server for processing..."),console.log("🗃️ File details:",{name:e.name,size:e.size,type:e.type,lastModified:e.lastModified}),console.log("🔗 Server URL:",`${this.serverUrl}/embed-bookmarks`);const n=new FormData;n.append("pdf",e),n.append("bookmarks",JSON.stringify(t));const r=await fetch(`${this.serverUrl}/embed-bookmarks`,{method:"POST",body:n});if(r.ok)return await r.blob();throw new Error(`Server error: ${r.status}`)}catch(n){throw console.error("❌ Server error:",n),n}}getServerUrl(){const e=window.location.hostname,t=window.location.port,n=window.location.protocol;return e==="localhost"||e==="127.0.0.1"?"http://localhost:8081":t?`${n}//${e}:${t}`:`${n}//${e}`}displayNetworkInfo(){const e=window.location.hostname;if(e!=="localhost"&&e!=="127.0.0.1")console.log(`📱 Accessing from network device: ${e}`),console.log(`🔗 Server URL: ${this.serverUrl}`);else{const t="http://192.168.1.182:3000";this.elements.networkInfo.style.display="block",this.elements.ipadUrl.textContent=t,console.log(`📱 iPad can access at: ${t}`)}}initializeElements(){this.elements={uploadArea:document.getElementById("uploadArea"),fileInput:document.getElementById("fileInput"),uploadBtn:document.getElementById("uploadBtn"),processing:document.getElementById("processing"),processingStatus:document.getElementById("processingStatus"),result:document.getElementById("result"),downloadBtn:document.getElementById("downloadBtn"),newFileBtn:document.getElementById("newFileBtn"),error:document.getElementById("error"),errorMessage:document.getElementById("errorMessage"),retryBtn:document.getElementById("retryBtn"),networkInfo:document.getElementById("networkInfo"),ipadUrl:document.getElementById("ipadUrl")}}bindEvents(){this.elements.uploadBtn.addEventListener("click",()=>{this.elements.fileInput.click()}),this.elements.fileInput.addEventListener("change",e=>{e.target.files.length>0&&this.handleFileUpload(e.target.files[0])}),this.elements.uploadArea.addEventListener("click",()=>{this.elements.fileInput.click()}),this.elements.uploadArea.addEventListener("dragover",e=>{e.preventDefault(),this.elements.uploadArea.classList.add("dragover")}),this.elements.uploadArea.addEventListener("dragleave",()=>{this.elements.uploadArea.classList.remove("dragover")}),this.elements.uploadArea.addEventListener("drop",e=>{e.preventDefault(),this.elements.uploadArea.classList.remove("dragover");const t=e.dataTransfer.files;t.length>0&&t[0].type==="application/pdf"&&this.handleFileUpload(t[0])}),this.elements.downloadBtn.addEventListener("click",()=>{this.downloadProcessedPDF()}),this.elements.newFileBtn.addEventListener("click",()=>{this.resetToUpload()}),this.elements.retryBtn.addEventListener("click",()=>{this.currentFile?this.handleFileUpload(this.currentFile):this.resetToUpload()})}async checkServerStatus(){try{console.log("🔍 Checking server status...");const e=await fetch(`${this.serverUrl}/health`,{method:"GET",mode:"cors"});e.ok?console.log("✅ Server is available"):(console.warn("⚠️ Server responded with error:",e.status),this.showServerWarning())}catch(e){console.warn("⚠️ Server not available:",e.message),this.showServerWarning()}}showServerWarning(){const e=document.createElement("div");e.innerHTML=`
            <div style="background: #fff3cd; color: #856404; padding: 10px; text-align: center; border-radius: 5px; margin-bottom: 20px; font-size: 0.9em;">
                ⚠️ Server not detected. Make sure to run: <code>npm run server</code>
            </div>
        `,document.querySelector(".container").insertBefore(e,document.querySelector("main"))}async handleFileUpload(e){if(console.log("📁 File uploaded:",e.name,e.size,"bytes"),!!this.validateFile(e)){this.currentFile=e,this.showProcessing();try{this.updateProcessingStatus("Reading PDF file..."),await this.delay(500),this.updateProcessingStatus("Adding bookmarks to pages 1, 3, and 6..."),await this.delay(1e3);const t=await this.processPDF(e);t.success?(this.processedPdfData=t.data,this.showResult()):this.showError(t.error||"Processing failed")}catch(t){console.error("❌ Processing error:",t),this.showError(t.message||"Processing failed")}}}validateFile(e){if(e.type!=="application/pdf")return this.showError("Please select a PDF file"),!1;const t=50*1024*1024;return e.size>t?(this.showError("File too large. Please select a PDF smaller than 50MB"),!1):e.size===0?(this.showError("The selected file is empty"),!1):!0}async processPDF(e){try{const t=new FormData;t.append("pdf",e);const n=[{title:"Page 1",page:1,level:1},{title:"Page 3",page:3,level:1},{title:"Page 6",page:6,level:1}];t.append("bookmarks",JSON.stringify(n)),console.log("📤 Sending PDF to server for processing..."),console.log("🗃️ File details:",{name:e.name,size:e.size,type:e.type,lastModified:e.lastModified});const r=await fetch(`${this.serverUrl}/embed-bookmarks`,{method:"POST",body:t,mode:"cors"});if(console.log("📡 Server response status:",r.status,r.statusText),console.log("📡 Response headers:",Object.fromEntries(r.headers.entries())),!r.ok){const o=await r.text();throw console.error("❌ Server error response:",o),new Error(`Server error: ${r.status} - ${o}`)}const s=r.headers.get("content-type");if(console.log("📄 Response content type:",s),s&&s.includes("application/pdf")){const o=await r.blob();return console.log("✅ PDF processed successfully, size:",o.size,"bytes"),{success:!0,data:o}}else{const o=await r.text();throw console.error("❌ Unexpected response format:",o),new Error("Server returned unexpected response format")}}catch(t){return console.error("❌ Server processing failed:",t),console.log("🔄 Attempting client-side processing fallback..."),await this.clientSideFallback(e)}}async clientSideFallback(e){try{const{PDFDocument:t}=await v(async()=>{const{PDFDocument:l}=await import("./index-DVAgkpTP.js");return{PDFDocument:l}},[]);this.updateProcessingStatus("Using client-side fallback...");const n=await e.arrayBuffer(),r=await t.load(n);r.setTitle(`${e.name} - With Bookmarks`),r.setKeywords("PDF Bookmark Embedder, Page 1, Page 3, Page 6"),r.setSubject("PDF with embedded bookmarks on pages 1, 3, and 6");const s=await r.save(),o=new Blob([s],{type:"application/pdf"});return console.log("✅ Client-side processing completed"),{success:!0,data:o}}catch(t){return console.error("❌ Client-side fallback failed:",t),{success:!1,error:"Both server and client-side processing failed. Please try a different PDF file."}}}downloadProcessedPDF(){if(!this.processedPdfData){this.showError("No processed PDF available");return}try{const e=URL.createObjectURL(this.processedPdfData),t=document.createElement("a");t.href=e,t.download=this.getDownloadFilename(),document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(e),console.log("📥 Download triggered")}catch(e){console.error("❌ Download failed:",e),this.showError("Download failed. Please try again.")}}getDownloadFilename(){return this.currentFile?`${this.currentFile.name.replace(".pdf","")}_with_bookmarks.pdf`:"pdf_with_bookmarks.pdf"}showProcessing(){this.hideAllStates(),this.elements.processing.style.display="block"}showResult(){this.hideAllStates(),this.elements.result.style.display="block"}showError(e){this.hideAllStates(),this.elements.error.style.display="block",this.elements.errorMessage.textContent=e}resetToUpload(){this.hideAllStates(),this.elements.uploadArea.style.display="block",this.elements.fileInput.value="",this.currentFile=null,this.processedPdfData=null}hideAllStates(){this.elements.uploadArea.style.display="none",this.elements.processing.style.display="none",this.elements.result.style.display="none",this.elements.error.style.display="none"}updateProcessingStatus(e){this.elements.processingStatus.textContent=e,console.log("🔄",e)}delay(e){return new Promise(t=>setTimeout(t,e))}}document.addEventListener("DOMContentLoaded",()=>{console.log("🚀 PDF Bookmark Embedder initialized"),new w});navigator.userAgent.includes("Safari")&&navigator.userAgent.includes("Mobile")&&(console.log("📱 iOS Safari detected - optimized mode active"),document.addEventListener("touchstart",()=>{},{passive:!0}));
//# sourceMappingURL=index-D8SpJ7JA.js.map
